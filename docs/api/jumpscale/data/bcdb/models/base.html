<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.6.4" />
<title>jumpscale.data.bcdb.models.base API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase;cursor:pointer}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>jumpscale.data.bcdb.models.base</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">from jumpscale.god import j
from jumpscale.data.schema import Property
from jumpscale.data.types import Integer, JSObject
import json

class JSObjBase:
    def __init__(self, model):
        self.model = model

    def get_dict(self):
        return self.model.get_dict(self)

    def save(self):
        return self.model.save_obj(self)

    def __str__(self):
        return json.dumps(self.get_dict(), indent=4)

class ModelBase:
    _schema = &#34;&#34;
    _name = &#34;&#34;
    def __init__(self, bcdb):
        self.schema = self._load_schema()
        self.schema.props[&#34;id&#34;] = Property()
        self.schema.props[&#34;id&#34;].unique = True
        self.schema.props[&#34;id&#34;].index = True
        self.schema.props[&#34;id&#34;].type = Integer()
        self.schema.props[&#34;id&#34;].name = &#34;id&#34;

        self.bcdb = bcdb
        self.name = self._name

    def _load_schema(self):
        return j.data.schema.parse_schema(self._schema)

    def create_obj(self, data):
        &#34;&#34;&#34;Create a new object and assign a new id to it with the given data dict.
        Missing props are defaultly initialized.

        Args:
            data (dict): The data dict that is used to create the object.

        Returns:
            JSObjBase: The newly created
        &#34;&#34;&#34;
        o = JSObjBase(self)
        data[&#39;id&#39;] = self._incr_id()
        self.set_from_dict(o, data)
        return o

    def _assert_uniqueness(self, obj):
        &#34;&#34;&#34;Checks that the object doesn&#39;t contain an already existing property that is marked as unique.

        Args:
            obj (JSObjBase): The JS Object.

        Raises:
            RuntimeError: If it contains a duplicate of a unique value.
        &#34;&#34;&#34;
        for prop in self.schema.props.values():
            if prop.unique:
                dbobj = self.get_by(prop.name, getattr(obj, prop.name))
                if dbobj is not None and dbobj.id != obj.id:
                    raise RuntimeError(f&#34;{prop.name} is unique. One already exists.&#34;)

    def save_obj(self, obj):
        &#34;&#34;&#34;Saves the object to the db. It forwards the call to the bcdb client.

        Args:
            obj (JSObjBase): The object to be saved.
        &#34;&#34;&#34;
        self._assert_uniqueness(obj)
        self.bcdb.save_obj(self, obj)

    def _incr_id(self):
        &#34;&#34;&#34;Increment the id counter and returns the newly incremented unique id.

        Returns:
            int: The new id.
        &#34;&#34;&#34;
        return self.bcdb.model_id_incr(self)

    def get_by(self, key, value):
        &#34;&#34;&#34;Search for objects whose key equal value.
        1. It searches in the redis index if key is indexed.
        2. Else, It&#39;s searched for in the sqlite index if the key is indexed for range search.
        3. Else, All objects in the db belonging to the given model is scanned linearly to determine the matching object.

        Args:
            key (str): The model property that is checked for.
            val (value): The value.

        Raises:
            RuntimeError: If the key is not a part of the schema.

        Returns:
            JSObjBase or None: The matched object (o: o.key == val). None if none matched.
        &#34;&#34;&#34;
        return self.bcdb.get_entry(self, key, value)

    def get_range(self, key, min, max):
        return self.bcdb.get_item_from_index_set(self, key, min, max)

    def get_pattern(self, key, pattern):
        &#34;&#34;&#34;Searches for objects whose key matches the given pattern in this model. The key must be registered in the text index.

        Args:
            key (str): The model property that the pattern is searched for in.
            pattern (str): The pattern to be searched for.

        Notes:
            Currently sonic server matches for some patterns and doesn&#39;t for others.

        Raises:
            RuntimeError: If the key is not defined in the model.
            RuntimeError: If the key is not indexed for search

        Returns:
            list[JSObjBase]: List of matching objects (o: o.key matches pattern).
        &#34;&#34;&#34;
        return self.bcdb.get_item_from_index_text(self, key, pattern)

    def get_dict(self, obj):
        &#34;&#34;&#34;Extracts a dict with all attributes from obj.

        Args:
            obj (JSObjBase): The object that the data is extracted from.

        Returns:
            dict: The data dict.
        &#34;&#34;&#34;
        d = {}
        for prop in self.schema.props.values():
            prop_name = prop.name
            d[prop_name] = getattr(obj, prop_name)
            if isinstance(prop.type, JSObject):
                d[prop_name] = d[prop_name].get_dict()
        return d

    def set_from_dict(self, o, d):
        &#34;&#34;&#34;Sets the attributes in the object o to the data from the dict d.
        Default values is used if it&#39;s not present in d.

        Args:
            o (JSObjBase): The object that will be set.
            d (dict): The dict containing the object new data.

        Notes:
            Type checking needs modification.
            It was assumed to receive strings convertable to the defined property.

        Raises:
            ValueError: If a value in the dict doesn&#39;t conform to the type checking rules imposed by the model&#39;s schema.

        Returns:
            JSObjBase: The JSObject after setting its data from the dict d.
        &#34;&#34;&#34;
        for prop in self.schema.props.values():
            prop_name = prop.name
            if prop_name in d:
                if not prop.type.check(d[prop_name]):
                    raise ValueError(&#34;Wrong form&#34;)
                if isinstance(prop.type, JSObject):
                    obj_model = self.bcdb.get_model_by_name(prop.defaultvalue)
                    setattr(o, prop_name, obj_model.load_obj_from_dict(d[prop_name]))
                else:
                    setattr(o, prop_name, prop.type.from_str(d[prop_name]))
            else:
                setattr(o, prop_name, prop.type.default)
        return o

    def load_obj_from_dict(self, d):
        &#34;&#34;&#34;Creates a new object with its data extracted from the d.

        Args:
            d (dict): The dict containing the newly created object&#39;s attributes.

        Returns:
            JSObjBase: The newly created object.
        &#34;&#34;&#34;
        o = JSObjBase(self)
        self.set_from_dict(o, d)
        return o</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="jumpscale.data.bcdb.models.base.JSObjBase"><code class="flex name class">
<span>class <span class="ident">JSObjBase</span></span>
<span>(</span><span>model)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class JSObjBase:
    def __init__(self, model):
        self.model = model

    def get_dict(self):
        return self.model.get_dict(self)

    def save(self):
        return self.model.save_obj(self)

    def __str__(self):
        return json.dumps(self.get_dict(), indent=4)</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="jumpscale.data.bcdb.models.base.JSObjBase.get_dict"><code class="name flex">
<span>def <span class="ident">get_dict</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_dict(self):
    return self.model.get_dict(self)</code></pre>
</details>
</dd>
<dt id="jumpscale.data.bcdb.models.base.JSObjBase.save"><code class="name flex">
<span>def <span class="ident">save</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def save(self):
    return self.model.save_obj(self)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="jumpscale.data.bcdb.models.base.ModelBase"><code class="flex name class">
<span>class <span class="ident">ModelBase</span></span>
<span>(</span><span>bcdb)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class ModelBase:
    _schema = &#34;&#34;
    _name = &#34;&#34;
    def __init__(self, bcdb):
        self.schema = self._load_schema()
        self.schema.props[&#34;id&#34;] = Property()
        self.schema.props[&#34;id&#34;].unique = True
        self.schema.props[&#34;id&#34;].index = True
        self.schema.props[&#34;id&#34;].type = Integer()
        self.schema.props[&#34;id&#34;].name = &#34;id&#34;

        self.bcdb = bcdb
        self.name = self._name

    def _load_schema(self):
        return j.data.schema.parse_schema(self._schema)

    def create_obj(self, data):
        &#34;&#34;&#34;Create a new object and assign a new id to it with the given data dict.
        Missing props are defaultly initialized.

        Args:
            data (dict): The data dict that is used to create the object.

        Returns:
            JSObjBase: The newly created
        &#34;&#34;&#34;
        o = JSObjBase(self)
        data[&#39;id&#39;] = self._incr_id()
        self.set_from_dict(o, data)
        return o

    def _assert_uniqueness(self, obj):
        &#34;&#34;&#34;Checks that the object doesn&#39;t contain an already existing property that is marked as unique.

        Args:
            obj (JSObjBase): The JS Object.

        Raises:
            RuntimeError: If it contains a duplicate of a unique value.
        &#34;&#34;&#34;
        for prop in self.schema.props.values():
            if prop.unique:
                dbobj = self.get_by(prop.name, getattr(obj, prop.name))
                if dbobj is not None and dbobj.id != obj.id:
                    raise RuntimeError(f&#34;{prop.name} is unique. One already exists.&#34;)

    def save_obj(self, obj):
        &#34;&#34;&#34;Saves the object to the db. It forwards the call to the bcdb client.

        Args:
            obj (JSObjBase): The object to be saved.
        &#34;&#34;&#34;
        self._assert_uniqueness(obj)
        self.bcdb.save_obj(self, obj)

    def _incr_id(self):
        &#34;&#34;&#34;Increment the id counter and returns the newly incremented unique id.

        Returns:
            int: The new id.
        &#34;&#34;&#34;
        return self.bcdb.model_id_incr(self)

    def get_by(self, key, value):
        &#34;&#34;&#34;Search for objects whose key equal value.
        1. It searches in the redis index if key is indexed.
        2. Else, It&#39;s searched for in the sqlite index if the key is indexed for range search.
        3. Else, All objects in the db belonging to the given model is scanned linearly to determine the matching object.

        Args:
            key (str): The model property that is checked for.
            val (value): The value.

        Raises:
            RuntimeError: If the key is not a part of the schema.

        Returns:
            JSObjBase or None: The matched object (o: o.key == val). None if none matched.
        &#34;&#34;&#34;
        return self.bcdb.get_entry(self, key, value)

    def get_range(self, key, min, max):
        return self.bcdb.get_item_from_index_set(self, key, min, max)

    def get_pattern(self, key, pattern):
        &#34;&#34;&#34;Searches for objects whose key matches the given pattern in this model. The key must be registered in the text index.

        Args:
            key (str): The model property that the pattern is searched for in.
            pattern (str): The pattern to be searched for.

        Notes:
            Currently sonic server matches for some patterns and doesn&#39;t for others.

        Raises:
            RuntimeError: If the key is not defined in the model.
            RuntimeError: If the key is not indexed for search

        Returns:
            list[JSObjBase]: List of matching objects (o: o.key matches pattern).
        &#34;&#34;&#34;
        return self.bcdb.get_item_from_index_text(self, key, pattern)

    def get_dict(self, obj):
        &#34;&#34;&#34;Extracts a dict with all attributes from obj.

        Args:
            obj (JSObjBase): The object that the data is extracted from.

        Returns:
            dict: The data dict.
        &#34;&#34;&#34;
        d = {}
        for prop in self.schema.props.values():
            prop_name = prop.name
            d[prop_name] = getattr(obj, prop_name)
            if isinstance(prop.type, JSObject):
                d[prop_name] = d[prop_name].get_dict()
        return d

    def set_from_dict(self, o, d):
        &#34;&#34;&#34;Sets the attributes in the object o to the data from the dict d.
        Default values is used if it&#39;s not present in d.

        Args:
            o (JSObjBase): The object that will be set.
            d (dict): The dict containing the object new data.

        Notes:
            Type checking needs modification.
            It was assumed to receive strings convertable to the defined property.

        Raises:
            ValueError: If a value in the dict doesn&#39;t conform to the type checking rules imposed by the model&#39;s schema.

        Returns:
            JSObjBase: The JSObject after setting its data from the dict d.
        &#34;&#34;&#34;
        for prop in self.schema.props.values():
            prop_name = prop.name
            if prop_name in d:
                if not prop.type.check(d[prop_name]):
                    raise ValueError(&#34;Wrong form&#34;)
                if isinstance(prop.type, JSObject):
                    obj_model = self.bcdb.get_model_by_name(prop.defaultvalue)
                    setattr(o, prop_name, obj_model.load_obj_from_dict(d[prop_name]))
                else:
                    setattr(o, prop_name, prop.type.from_str(d[prop_name]))
            else:
                setattr(o, prop_name, prop.type.default)
        return o

    def load_obj_from_dict(self, d):
        &#34;&#34;&#34;Creates a new object with its data extracted from the d.

        Args:
            d (dict): The dict containing the newly created object&#39;s attributes.

        Returns:
            JSObjBase: The newly created object.
        &#34;&#34;&#34;
        o = JSObjBase(self)
        self.set_from_dict(o, d)
        return o</code></pre>
</details>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="jumpscale.data.bcdb.models.model_model.ModelModel" href="model_model.html#jumpscale.data.bcdb.models.model_model.ModelModel">ModelModel</a></li>
<li><a title="jumpscale.data.bcdb.models.user_model.UserModel" href="user_model.html#jumpscale.data.bcdb.models.user_model.UserModel">UserModel</a></li>
<li><a title="jumpscale.data.bcdb.models.proj_model.ProjModel" href="proj_model.html#jumpscale.data.bcdb.models.proj_model.ProjModel">ProjModel</a></li>
<li><a title="jumpscale.data.bcdb.models.test_model.TestModel" href="test_model.html#jumpscale.data.bcdb.models.test_model.TestModel">TestModel</a></li>
<li><a title="jumpscale.data.bcdb.models.db_model.DBModel" href="db_model.html#jumpscale.data.bcdb.models.db_model.DBModel">DBModel</a></li>
<li><a title="jumpscale.data.bcdb.models.post_model.QuoteModel" href="post_model.html#jumpscale.data.bcdb.models.post_model.QuoteModel">QuoteModel</a></li>
<li><a title="jumpscale.data.bcdb.models.emplyee_model.EmployeeModel" href="emplyee_model.html#jumpscale.data.bcdb.models.emplyee_model.EmployeeModel">EmployeeModel</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="jumpscale.data.bcdb.models.base.ModelBase.create_obj"><code class="name flex">
<span>def <span class="ident">create_obj</span></span>(<span>self, data)</span>
</code></dt>
<dd>
<section class="desc"><p>Create a new object and assign a new id to it with the given data dict.
Missing props are defaultly initialized.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>data</code></strong> :&ensp;<code>dict</code></dt>
<dd>The data dict that is used to create the object.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><a title="jumpscale.data.bcdb.models.base.JSObjBase" href="#jumpscale.data.bcdb.models.base.JSObjBase"><code>JSObjBase</code></a></strong></dt>
<dd>The newly created</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def create_obj(self, data):
    &#34;&#34;&#34;Create a new object and assign a new id to it with the given data dict.
    Missing props are defaultly initialized.

    Args:
        data (dict): The data dict that is used to create the object.

    Returns:
        JSObjBase: The newly created
    &#34;&#34;&#34;
    o = JSObjBase(self)
    data[&#39;id&#39;] = self._incr_id()
    self.set_from_dict(o, data)
    return o</code></pre>
</details>
</dd>
<dt id="jumpscale.data.bcdb.models.base.ModelBase.get_by"><code class="name flex">
<span>def <span class="ident">get_by</span></span>(<span>self, key, value)</span>
</code></dt>
<dd>
<section class="desc"><p>Search for objects whose key equal value.
1. It searches in the redis index if key is indexed.
2. Else, It's searched for in the sqlite index if the key is indexed for range search.
3. Else, All objects in the db belonging to the given model is scanned linearly to determine the matching object.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>key</code></strong> :&ensp;<code>str</code></dt>
<dd>The model property that is checked for.</dd>
<dt><strong><code>val</code></strong> :&ensp;<code>value</code></dt>
<dd>The value.</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><strong><code>RuntimeError</code></strong></dt>
<dd>If the key is not a part of the schema.</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>JSObjBase or None: The matched object (o: o.key == val). None if none matched.</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_by(self, key, value):
    &#34;&#34;&#34;Search for objects whose key equal value.
    1. It searches in the redis index if key is indexed.
    2. Else, It&#39;s searched for in the sqlite index if the key is indexed for range search.
    3. Else, All objects in the db belonging to the given model is scanned linearly to determine the matching object.

    Args:
        key (str): The model property that is checked for.
        val (value): The value.

    Raises:
        RuntimeError: If the key is not a part of the schema.

    Returns:
        JSObjBase or None: The matched object (o: o.key == val). None if none matched.
    &#34;&#34;&#34;
    return self.bcdb.get_entry(self, key, value)</code></pre>
</details>
</dd>
<dt id="jumpscale.data.bcdb.models.base.ModelBase.get_dict"><code class="name flex">
<span>def <span class="ident">get_dict</span></span>(<span>self, obj)</span>
</code></dt>
<dd>
<section class="desc"><p>Extracts a dict with all attributes from obj.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>obj</code></strong> :&ensp;<a title="jumpscale.data.bcdb.models.base.JSObjBase" href="#jumpscale.data.bcdb.models.base.JSObjBase"><code>JSObjBase</code></a></dt>
<dd>The object that the data is extracted from.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>dict</code></strong></dt>
<dd>The data dict.</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_dict(self, obj):
    &#34;&#34;&#34;Extracts a dict with all attributes from obj.

    Args:
        obj (JSObjBase): The object that the data is extracted from.

    Returns:
        dict: The data dict.
    &#34;&#34;&#34;
    d = {}
    for prop in self.schema.props.values():
        prop_name = prop.name
        d[prop_name] = getattr(obj, prop_name)
        if isinstance(prop.type, JSObject):
            d[prop_name] = d[prop_name].get_dict()
    return d</code></pre>
</details>
</dd>
<dt id="jumpscale.data.bcdb.models.base.ModelBase.get_pattern"><code class="name flex">
<span>def <span class="ident">get_pattern</span></span>(<span>self, key, pattern)</span>
</code></dt>
<dd>
<section class="desc"><p>Searches for objects whose key matches the given pattern in this model. The key must be registered in the text index.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>key</code></strong> :&ensp;<code>str</code></dt>
<dd>The model property that the pattern is searched for in.</dd>
<dt><strong><code>pattern</code></strong> :&ensp;<code>str</code></dt>
<dd>The pattern to be searched for.</dd>
</dl>
<h2 id="notes">Notes</h2>
<p>Currently sonic server matches for some patterns and doesn't for others.</p>
<h2 id="raises">Raises</h2>
<dl>
<dt><strong><code>RuntimeError</code></strong></dt>
<dd>If the key is not defined in the model.</dd>
<dt><strong><code>RuntimeError</code></strong></dt>
<dd>If the key is not indexed for search</dd>
</dl>
<h2 id="returns">Returns</h2>
<p>list[JSObjBase]: List of matching objects (o: o.key matches pattern).</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_pattern(self, key, pattern):
    &#34;&#34;&#34;Searches for objects whose key matches the given pattern in this model. The key must be registered in the text index.

    Args:
        key (str): The model property that the pattern is searched for in.
        pattern (str): The pattern to be searched for.

    Notes:
        Currently sonic server matches for some patterns and doesn&#39;t for others.

    Raises:
        RuntimeError: If the key is not defined in the model.
        RuntimeError: If the key is not indexed for search

    Returns:
        list[JSObjBase]: List of matching objects (o: o.key matches pattern).
    &#34;&#34;&#34;
    return self.bcdb.get_item_from_index_text(self, key, pattern)</code></pre>
</details>
</dd>
<dt id="jumpscale.data.bcdb.models.base.ModelBase.get_range"><code class="name flex">
<span>def <span class="ident">get_range</span></span>(<span>self, key, min, max)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_range(self, key, min, max):
    return self.bcdb.get_item_from_index_set(self, key, min, max)</code></pre>
</details>
</dd>
<dt id="jumpscale.data.bcdb.models.base.ModelBase.load_obj_from_dict"><code class="name flex">
<span>def <span class="ident">load_obj_from_dict</span></span>(<span>self, d)</span>
</code></dt>
<dd>
<section class="desc"><p>Creates a new object with its data extracted from the d.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>d</code></strong> :&ensp;<code>dict</code></dt>
<dd>The dict containing the newly created object's attributes.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><a title="jumpscale.data.bcdb.models.base.JSObjBase" href="#jumpscale.data.bcdb.models.base.JSObjBase"><code>JSObjBase</code></a></strong></dt>
<dd>The newly created object.</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def load_obj_from_dict(self, d):
    &#34;&#34;&#34;Creates a new object with its data extracted from the d.

    Args:
        d (dict): The dict containing the newly created object&#39;s attributes.

    Returns:
        JSObjBase: The newly created object.
    &#34;&#34;&#34;
    o = JSObjBase(self)
    self.set_from_dict(o, d)
    return o</code></pre>
</details>
</dd>
<dt id="jumpscale.data.bcdb.models.base.ModelBase.save_obj"><code class="name flex">
<span>def <span class="ident">save_obj</span></span>(<span>self, obj)</span>
</code></dt>
<dd>
<section class="desc"><p>Saves the object to the db. It forwards the call to the bcdb client.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>obj</code></strong> :&ensp;<a title="jumpscale.data.bcdb.models.base.JSObjBase" href="#jumpscale.data.bcdb.models.base.JSObjBase"><code>JSObjBase</code></a></dt>
<dd>The object to be saved.</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def save_obj(self, obj):
    &#34;&#34;&#34;Saves the object to the db. It forwards the call to the bcdb client.

    Args:
        obj (JSObjBase): The object to be saved.
    &#34;&#34;&#34;
    self._assert_uniqueness(obj)
    self.bcdb.save_obj(self, obj)</code></pre>
</details>
</dd>
<dt id="jumpscale.data.bcdb.models.base.ModelBase.set_from_dict"><code class="name flex">
<span>def <span class="ident">set_from_dict</span></span>(<span>self, o, d)</span>
</code></dt>
<dd>
<section class="desc"><p>Sets the attributes in the object o to the data from the dict d.
Default values is used if it's not present in d.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>o</code></strong> :&ensp;<a title="jumpscale.data.bcdb.models.base.JSObjBase" href="#jumpscale.data.bcdb.models.base.JSObjBase"><code>JSObjBase</code></a></dt>
<dd>The object that will be set.</dd>
<dt><strong><code>d</code></strong> :&ensp;<code>dict</code></dt>
<dd>The dict containing the object new data.</dd>
</dl>
<h2 id="notes">Notes</h2>
<p>Type checking needs modification.
It was assumed to receive strings convertable to the defined property.</p>
<h2 id="raises">Raises</h2>
<dl>
<dt><strong><code>ValueError</code></strong></dt>
<dd>If a value in the dict doesn't conform to the type checking rules imposed by the model's schema.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><a title="jumpscale.data.bcdb.models.base.JSObjBase" href="#jumpscale.data.bcdb.models.base.JSObjBase"><code>JSObjBase</code></a></strong></dt>
<dd>The JSObject after setting its data from the dict d.</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def set_from_dict(self, o, d):
    &#34;&#34;&#34;Sets the attributes in the object o to the data from the dict d.
    Default values is used if it&#39;s not present in d.

    Args:
        o (JSObjBase): The object that will be set.
        d (dict): The dict containing the object new data.

    Notes:
        Type checking needs modification.
        It was assumed to receive strings convertable to the defined property.

    Raises:
        ValueError: If a value in the dict doesn&#39;t conform to the type checking rules imposed by the model&#39;s schema.

    Returns:
        JSObjBase: The JSObject after setting its data from the dict d.
    &#34;&#34;&#34;
    for prop in self.schema.props.values():
        prop_name = prop.name
        if prop_name in d:
            if not prop.type.check(d[prop_name]):
                raise ValueError(&#34;Wrong form&#34;)
            if isinstance(prop.type, JSObject):
                obj_model = self.bcdb.get_model_by_name(prop.defaultvalue)
                setattr(o, prop_name, obj_model.load_obj_from_dict(d[prop_name]))
            else:
                setattr(o, prop_name, prop.type.from_str(d[prop_name]))
        else:
            setattr(o, prop_name, prop.type.default)
    return o</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="jumpscale.data.bcdb.models" href="index.html">jumpscale.data.bcdb.models</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="jumpscale.data.bcdb.models.base.JSObjBase" href="#jumpscale.data.bcdb.models.base.JSObjBase">JSObjBase</a></code></h4>
<ul class="">
<li><code><a title="jumpscale.data.bcdb.models.base.JSObjBase.get_dict" href="#jumpscale.data.bcdb.models.base.JSObjBase.get_dict">get_dict</a></code></li>
<li><code><a title="jumpscale.data.bcdb.models.base.JSObjBase.save" href="#jumpscale.data.bcdb.models.base.JSObjBase.save">save</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jumpscale.data.bcdb.models.base.ModelBase" href="#jumpscale.data.bcdb.models.base.ModelBase">ModelBase</a></code></h4>
<ul class="two-column">
<li><code><a title="jumpscale.data.bcdb.models.base.ModelBase.create_obj" href="#jumpscale.data.bcdb.models.base.ModelBase.create_obj">create_obj</a></code></li>
<li><code><a title="jumpscale.data.bcdb.models.base.ModelBase.get_by" href="#jumpscale.data.bcdb.models.base.ModelBase.get_by">get_by</a></code></li>
<li><code><a title="jumpscale.data.bcdb.models.base.ModelBase.get_dict" href="#jumpscale.data.bcdb.models.base.ModelBase.get_dict">get_dict</a></code></li>
<li><code><a title="jumpscale.data.bcdb.models.base.ModelBase.get_pattern" href="#jumpscale.data.bcdb.models.base.ModelBase.get_pattern">get_pattern</a></code></li>
<li><code><a title="jumpscale.data.bcdb.models.base.ModelBase.get_range" href="#jumpscale.data.bcdb.models.base.ModelBase.get_range">get_range</a></code></li>
<li><code><a title="jumpscale.data.bcdb.models.base.ModelBase.load_obj_from_dict" href="#jumpscale.data.bcdb.models.base.ModelBase.load_obj_from_dict">load_obj_from_dict</a></code></li>
<li><code><a title="jumpscale.data.bcdb.models.base.ModelBase.save_obj" href="#jumpscale.data.bcdb.models.base.ModelBase.save_obj">save_obj</a></code></li>
<li><code><a title="jumpscale.data.bcdb.models.base.ModelBase.set_from_dict" href="#jumpscale.data.bcdb.models.base.ModelBase.set_from_dict">set_from_dict</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.6.4</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>
