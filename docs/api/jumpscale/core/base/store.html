<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.6.3" />
<title>jumpscale.core.base.store API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase;cursor:pointer}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>jumpscale.core.base.store</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>Source code</summary>
<pre><code class="python">import os
import shutil

import redis

from abc import ABC, abstractmethod

from jumpscale.data.nacl import NACL
from jumpscale.data.serializers import base64, json
from jumpscale.core.config import Environment
from jumpscale.sals.fs import readFile, writeFile


class InvalidPrivateKey(Exception):
    pass


class Location:
    &#34;&#34;&#34;dot-separated auto-location for any type

    for example, if we have a class in jumpscale/clients/redis/&lt;type&gt;
    location name will be jumpscale.clients.redis.&lt;type&gt;

    it can have a parent of any name
    &#34;&#34;&#34;

    def __init__(self, type_, parent_name):
        self.type = type_

        self.path_list = [self.type.__module__, self.type.__name__]
        if parent_name:
            self.path_list = [parent_name] + self.path_list

    @property
    def name(self):
        return &#34;.&#34;.join(self.path_list)

    @property
    def path(self):
        return os.path.join(*self.name.split(&#34;.&#34;))


class EncryptionMixin:
    def encrypt(self, data):
        &#34;&#34;&#34;encrypt data

        Args:
            data (str): input string

        Returns:
            bytes: encrypted data as byte string
        &#34;&#34;&#34;
        if not isinstance(data, bytes):
            data = data.encode()
        return self.nacl.encrypt(data, self.public_key)

    def decrypt(self, data):
        &#34;&#34;&#34;decrypt data

        Args:
            data (bytes): encrypted byte string

        Returns:
            str: decrypted data
        &#34;&#34;&#34;
        return self.nacl.decrypt(data, self.public_key).decode()


class ConfigStore(ABC):
    &#34;&#34;&#34;the interface every config store should implement&#34;&#34;&#34;

    @abstractmethod
    def read(self, instance_name):
        pass

    @abstractmethod
    def write(self, instance_name, data):
        pass

    @abstractmethod
    def list_all(self):
        pass

    @abstractmethod
    def delete(self):
        pass


class EncryptedConfigStore(ConfigStore, EncryptionMixin):
    &#34;&#34;&#34;secure config storage base&#34;&#34;&#34;

    # TODO: encrypt/decrypt by section (config key)

    def __init__(self, type_, parent_name=None):
        self.type = type_
        self.config_env = Environment()
        self.priv_key = base64.decode(self.config_env.get_private_key())
        self.nacl = NACL(private_key=self.priv_key)
        self.public_key = self.nacl.public_key.encode()

        if not self.priv_key:
            raise InvalidPrivateKey

        self.parent_name = parent_name

    def get_type_location(self, type_, parent_name):
        return Location(type_, parent_name)

    @property
    def location(self):
        return self.get_type_location(self.type, self.parent_name)

    def get(self, instance_name):
        &#34;&#34;&#34;get instance config

        Args:
            instance_name (str): instance name

        Returns:
            dict: instance config as dict (key, values)
        &#34;&#34;&#34;
        new_config = {}
        config = json.loads(self.read(instance_name))

        for name, value in config.items():
            if name.startswith(&#34;__&#34;):
                new_config[name.lstrip(&#34;__&#34;)] = self.decrypt(base64.decode(value))
            else:
                new_config[name] = value
        return new_config

    def get_all(self):
        return {name: self.get(name) for name in self.list_all()}

    def save(self, instance_name, config):
        &#34;&#34;&#34;save instance config

        Args:
            instance_name (str): name of instnace
            config (dict): config data, any key that starts with `__` will be encrypted

        Returns:
            bool: written or not
        &#34;&#34;&#34;
        new_config = {}
        for name, value in config.items():
            if name.startswith(&#34;__&#34;):
                new_config[name] = base64.encode(self.encrypt(value)).decode(&#34;ascii&#34;)
            else:
                new_config[name] = value
        return self.write(instance_name, json.dumps(new_config))


class FileSystemStore(EncryptedConfigStore):
    def __init__(self, type_, parent_name=None):
        super(FileSystemStore, self).__init__(type_, parent_name)
        self.root = self.config_env.get_store_config(&#34;filesystem&#34;)[&#34;path&#34;]

    @property
    def config_root(self):
        return os.path.join(self.root, self.location.path)

    def get_instance_root(self, instance_name):
        return os.path.join(self.config_root, instance_name)

    def get_path(self, instance_name):
        return os.path.join(self.get_instance_root(instance_name), &#34;data&#34;)

    def make_path(self, path):
        if not os.path.exists(path):
            os.makedirs(os.path.dirname(path), exist_ok=True)
            os.mknod(path)

    def read(self, instance_name):
        path = self.get_path(instance_name)
        return readFile(path)

    def list_all(self):
        if not os.path.exists(self.config_root):
            return []
        return os.listdir(self.config_root)

    def write(self, instance_name, data):
        path = self.get_path(instance_name)
        self.make_path(path)
        return writeFile(path, data.encode())

    def delete(self, instance_name):
        path = self.get_instance_root(instance_name)
        if os.path.exists(path):
            # TODO: replace with sal fs
            shutil.rmtree(path)


class RedisStore(EncryptedConfigStore):
    def __init__(self, type_, parent_name=None):
        super().__init__(type_, parent_name)
        redis_config = self.config_env.get_store_config(&#34;redis&#34;)
        self.redis_client = redis.Redis(redis_config[&#34;hostname&#34;], redis_config[&#34;port&#34;])

    def get_key(self, instance_name):
        return &#34;.&#34;.join([self.location.name, instance_name])

    def read(self, instance_name):
        return self.redis_client.get(self.get_key(instance_name))

    def get_type_keys(self):
        return self.redis_client.keys(f&#34;{self.location.name}.*&#34;)

    def get_instance_keys(self, instance_name):
        return self.redis_client.keys(f&#34;{self.location.name}.{instance_name}*&#34;)

    def list_all(self):
        names = []

        keys = self.get_type_keys()
        for key in keys:
            name = key.decode().replace(self.location.name, &#34;&#34;).lstrip(&#34;.&#34;)
            if &#34;.&#34; not in name:
                names.append(name)
        return names

    def write(self, instance_name, data):
        return self.redis_client.set(self.get_key(instance_name), data)

    def delete(self, instance_name):
        return self.redis_client.delete(*self.get_instance_keys(instance_name))</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="jumpscale.core.base.store.ConfigStore"><code class="flex name class">
<span>class <span class="ident">ConfigStore</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>the interface every config store should implement</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class ConfigStore(ABC):
    &#34;&#34;&#34;the interface every config store should implement&#34;&#34;&#34;

    @abstractmethod
    def read(self, instance_name):
        pass

    @abstractmethod
    def write(self, instance_name, data):
        pass

    @abstractmethod
    def list_all(self):
        pass

    @abstractmethod
    def delete(self):
        pass</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>abc.ABC</li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="jumpscale.core.base.store.EncryptedConfigStore" href="#jumpscale.core.base.store.EncryptedConfigStore">EncryptedConfigStore</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="jumpscale.core.base.store.ConfigStore.delete"><code class="name flex">
<span>def <span class="ident">delete</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">@abstractmethod
def delete(self):
    pass</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.ConfigStore.list_all"><code class="name flex">
<span>def <span class="ident">list_all</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">@abstractmethod
def list_all(self):
    pass</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.ConfigStore.read"><code class="name flex">
<span>def <span class="ident">read</span></span>(<span>self, instance_name)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">@abstractmethod
def read(self, instance_name):
    pass</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.ConfigStore.write"><code class="name flex">
<span>def <span class="ident">write</span></span>(<span>self, instance_name, data)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">@abstractmethod
def write(self, instance_name, data):
    pass</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="jumpscale.core.base.store.EncryptedConfigStore"><code class="flex name class">
<span>class <span class="ident">EncryptedConfigStore</span></span>
<span>(</span><span>type_, parent_name=None)</span>
</code></dt>
<dd>
<section class="desc"><p>secure config storage base</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class EncryptedConfigStore(ConfigStore, EncryptionMixin):
    &#34;&#34;&#34;secure config storage base&#34;&#34;&#34;

    # TODO: encrypt/decrypt by section (config key)

    def __init__(self, type_, parent_name=None):
        self.type = type_
        self.config_env = Environment()
        self.priv_key = base64.decode(self.config_env.get_private_key())
        self.nacl = NACL(private_key=self.priv_key)
        self.public_key = self.nacl.public_key.encode()

        if not self.priv_key:
            raise InvalidPrivateKey

        self.parent_name = parent_name

    def get_type_location(self, type_, parent_name):
        return Location(type_, parent_name)

    @property
    def location(self):
        return self.get_type_location(self.type, self.parent_name)

    def get(self, instance_name):
        &#34;&#34;&#34;get instance config

        Args:
            instance_name (str): instance name

        Returns:
            dict: instance config as dict (key, values)
        &#34;&#34;&#34;
        new_config = {}
        config = json.loads(self.read(instance_name))

        for name, value in config.items():
            if name.startswith(&#34;__&#34;):
                new_config[name.lstrip(&#34;__&#34;)] = self.decrypt(base64.decode(value))
            else:
                new_config[name] = value
        return new_config

    def get_all(self):
        return {name: self.get(name) for name in self.list_all()}

    def save(self, instance_name, config):
        &#34;&#34;&#34;save instance config

        Args:
            instance_name (str): name of instnace
            config (dict): config data, any key that starts with `__` will be encrypted

        Returns:
            bool: written or not
        &#34;&#34;&#34;
        new_config = {}
        for name, value in config.items():
            if name.startswith(&#34;__&#34;):
                new_config[name] = base64.encode(self.encrypt(value)).decode(&#34;ascii&#34;)
            else:
                new_config[name] = value
        return self.write(instance_name, json.dumps(new_config))</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="jumpscale.core.base.store.ConfigStore" href="#jumpscale.core.base.store.ConfigStore">ConfigStore</a></li>
<li>abc.ABC</li>
<li><a title="jumpscale.core.base.store.EncryptionMixin" href="#jumpscale.core.base.store.EncryptionMixin">EncryptionMixin</a></li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="jumpscale.core.base.store.FileSystemStore" href="#jumpscale.core.base.store.FileSystemStore">FileSystemStore</a></li>
<li><a title="jumpscale.core.base.store.RedisStore" href="#jumpscale.core.base.store.RedisStore">RedisStore</a></li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="jumpscale.core.base.store.EncryptedConfigStore.location"><code class="name">var <span class="ident">location</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">@property
def location(self):
    return self.get_type_location(self.type, self.parent_name)</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="jumpscale.core.base.store.EncryptedConfigStore.get"><code class="name flex">
<span>def <span class="ident">get</span></span>(<span>self, instance_name)</span>
</code></dt>
<dd>
<section class="desc"><p>get instance config</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>instance_name</code></strong> :&ensp;<code>str</code></dt>
<dd>instance name</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>dict</code></strong></dt>
<dd>instance config as dict (key, values)</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get(self, instance_name):
    &#34;&#34;&#34;get instance config

    Args:
        instance_name (str): instance name

    Returns:
        dict: instance config as dict (key, values)
    &#34;&#34;&#34;
    new_config = {}
    config = json.loads(self.read(instance_name))

    for name, value in config.items():
        if name.startswith(&#34;__&#34;):
            new_config[name.lstrip(&#34;__&#34;)] = self.decrypt(base64.decode(value))
        else:
            new_config[name] = value
    return new_config</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.EncryptedConfigStore.get_all"><code class="name flex">
<span>def <span class="ident">get_all</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_all(self):
    return {name: self.get(name) for name in self.list_all()}</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.EncryptedConfigStore.get_type_location"><code class="name flex">
<span>def <span class="ident">get_type_location</span></span>(<span>self, type_, parent_name)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_type_location(self, type_, parent_name):
    return Location(type_, parent_name)</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.EncryptedConfigStore.save"><code class="name flex">
<span>def <span class="ident">save</span></span>(<span>self, instance_name, config)</span>
</code></dt>
<dd>
<section class="desc"><p>save instance config</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>instance_name</code></strong> :&ensp;<code>str</code></dt>
<dd>name of instnace</dd>
<dt><strong><code>config</code></strong> :&ensp;<code>dict</code></dt>
<dd>config data, any key that starts with <code>__</code> will be encrypted</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>bool</code></strong></dt>
<dd>written or not</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def save(self, instance_name, config):
    &#34;&#34;&#34;save instance config

    Args:
        instance_name (str): name of instnace
        config (dict): config data, any key that starts with `__` will be encrypted

    Returns:
        bool: written or not
    &#34;&#34;&#34;
    new_config = {}
    for name, value in config.items():
        if name.startswith(&#34;__&#34;):
            new_config[name] = base64.encode(self.encrypt(value)).decode(&#34;ascii&#34;)
        else:
            new_config[name] = value
    return self.write(instance_name, json.dumps(new_config))</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="jumpscale.core.base.store.EncryptionMixin" href="#jumpscale.core.base.store.EncryptionMixin">EncryptionMixin</a></b></code>:
<ul class="hlist">
<li><code><a title="jumpscale.core.base.store.EncryptionMixin.decrypt" href="#jumpscale.core.base.store.EncryptionMixin.decrypt">decrypt</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptionMixin.encrypt" href="#jumpscale.core.base.store.EncryptionMixin.encrypt">encrypt</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="jumpscale.core.base.store.EncryptionMixin"><code class="flex name class">
<span>class <span class="ident">EncryptionMixin</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class EncryptionMixin:
    def encrypt(self, data):
        &#34;&#34;&#34;encrypt data

        Args:
            data (str): input string

        Returns:
            bytes: encrypted data as byte string
        &#34;&#34;&#34;
        if not isinstance(data, bytes):
            data = data.encode()
        return self.nacl.encrypt(data, self.public_key)

    def decrypt(self, data):
        &#34;&#34;&#34;decrypt data

        Args:
            data (bytes): encrypted byte string

        Returns:
            str: decrypted data
        &#34;&#34;&#34;
        return self.nacl.decrypt(data, self.public_key).decode()</code></pre>
</details>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="jumpscale.core.base.store.EncryptedConfigStore" href="#jumpscale.core.base.store.EncryptedConfigStore">EncryptedConfigStore</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="jumpscale.core.base.store.EncryptionMixin.decrypt"><code class="name flex">
<span>def <span class="ident">decrypt</span></span>(<span>self, data)</span>
</code></dt>
<dd>
<section class="desc"><p>decrypt data</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>data</code></strong> :&ensp;<code>bytes</code></dt>
<dd>encrypted byte string</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>str</code></strong></dt>
<dd>decrypted data</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def decrypt(self, data):
    &#34;&#34;&#34;decrypt data

    Args:
        data (bytes): encrypted byte string

    Returns:
        str: decrypted data
    &#34;&#34;&#34;
    return self.nacl.decrypt(data, self.public_key).decode()</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.EncryptionMixin.encrypt"><code class="name flex">
<span>def <span class="ident">encrypt</span></span>(<span>self, data)</span>
</code></dt>
<dd>
<section class="desc"><p>encrypt data</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>data</code></strong> :&ensp;<code>str</code></dt>
<dd>input string</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>bytes</code></strong></dt>
<dd>encrypted data as byte string</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def encrypt(self, data):
    &#34;&#34;&#34;encrypt data

    Args:
        data (str): input string

    Returns:
        bytes: encrypted data as byte string
    &#34;&#34;&#34;
    if not isinstance(data, bytes):
        data = data.encode()
    return self.nacl.encrypt(data, self.public_key)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="jumpscale.core.base.store.FileSystemStore"><code class="flex name class">
<span>class <span class="ident">FileSystemStore</span></span>
<span>(</span><span>type_, parent_name=None)</span>
</code></dt>
<dd>
<section class="desc"><p>secure config storage base</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class FileSystemStore(EncryptedConfigStore):
    def __init__(self, type_, parent_name=None):
        super(FileSystemStore, self).__init__(type_, parent_name)
        self.root = self.config_env.get_store_config(&#34;filesystem&#34;)[&#34;path&#34;]

    @property
    def config_root(self):
        return os.path.join(self.root, self.location.path)

    def get_instance_root(self, instance_name):
        return os.path.join(self.config_root, instance_name)

    def get_path(self, instance_name):
        return os.path.join(self.get_instance_root(instance_name), &#34;data&#34;)

    def make_path(self, path):
        if not os.path.exists(path):
            os.makedirs(os.path.dirname(path), exist_ok=True)
            os.mknod(path)

    def read(self, instance_name):
        path = self.get_path(instance_name)
        return readFile(path)

    def list_all(self):
        if not os.path.exists(self.config_root):
            return []
        return os.listdir(self.config_root)

    def write(self, instance_name, data):
        path = self.get_path(instance_name)
        self.make_path(path)
        return writeFile(path, data.encode())

    def delete(self, instance_name):
        path = self.get_instance_root(instance_name)
        if os.path.exists(path):
            # TODO: replace with sal fs
            shutil.rmtree(path)</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="jumpscale.core.base.store.EncryptedConfigStore" href="#jumpscale.core.base.store.EncryptedConfigStore">EncryptedConfigStore</a></li>
<li><a title="jumpscale.core.base.store.ConfigStore" href="#jumpscale.core.base.store.ConfigStore">ConfigStore</a></li>
<li>abc.ABC</li>
<li><a title="jumpscale.core.base.store.EncryptionMixin" href="#jumpscale.core.base.store.EncryptionMixin">EncryptionMixin</a></li>
</ul>
<h3>Instance variables</h3>
<dl>
<dt id="jumpscale.core.base.store.FileSystemStore.config_root"><code class="name">var <span class="ident">config_root</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">@property
def config_root(self):
    return os.path.join(self.root, self.location.path)</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="jumpscale.core.base.store.FileSystemStore.delete"><code class="name flex">
<span>def <span class="ident">delete</span></span>(<span>self, instance_name)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def delete(self, instance_name):
    path = self.get_instance_root(instance_name)
    if os.path.exists(path):
        # TODO: replace with sal fs
        shutil.rmtree(path)</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.FileSystemStore.get_instance_root"><code class="name flex">
<span>def <span class="ident">get_instance_root</span></span>(<span>self, instance_name)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_instance_root(self, instance_name):
    return os.path.join(self.config_root, instance_name)</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.FileSystemStore.get_path"><code class="name flex">
<span>def <span class="ident">get_path</span></span>(<span>self, instance_name)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_path(self, instance_name):
    return os.path.join(self.get_instance_root(instance_name), &#34;data&#34;)</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.FileSystemStore.list_all"><code class="name flex">
<span>def <span class="ident">list_all</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def list_all(self):
    if not os.path.exists(self.config_root):
        return []
    return os.listdir(self.config_root)</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.FileSystemStore.make_path"><code class="name flex">
<span>def <span class="ident">make_path</span></span>(<span>self, path)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def make_path(self, path):
    if not os.path.exists(path):
        os.makedirs(os.path.dirname(path), exist_ok=True)
        os.mknod(path)</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.FileSystemStore.read"><code class="name flex">
<span>def <span class="ident">read</span></span>(<span>self, instance_name)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def read(self, instance_name):
    path = self.get_path(instance_name)
    return readFile(path)</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.FileSystemStore.write"><code class="name flex">
<span>def <span class="ident">write</span></span>(<span>self, instance_name, data)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def write(self, instance_name, data):
    path = self.get_path(instance_name)
    self.make_path(path)
    return writeFile(path, data.encode())</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="jumpscale.core.base.store.EncryptedConfigStore" href="#jumpscale.core.base.store.EncryptedConfigStore">EncryptedConfigStore</a></b></code>:
<ul class="hlist">
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.decrypt" href="#jumpscale.core.base.store.EncryptionMixin.decrypt">decrypt</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.encrypt" href="#jumpscale.core.base.store.EncryptionMixin.encrypt">encrypt</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.get" href="#jumpscale.core.base.store.EncryptedConfigStore.get">get</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.save" href="#jumpscale.core.base.store.EncryptedConfigStore.save">save</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="jumpscale.core.base.store.InvalidPrivateKey"><code class="flex name class">
<span>class <span class="ident">InvalidPrivateKey</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<section class="desc"><p>Common base class for all non-exit exceptions.</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class InvalidPrivateKey(Exception):
    pass</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="jumpscale.core.base.store.Location"><code class="flex name class">
<span>class <span class="ident">Location</span></span>
<span>(</span><span>type_, parent_name)</span>
</code></dt>
<dd>
<section class="desc"><p>dot-separated auto-location for any type</p>
<p>for example, if we have a class in jumpscale/clients/redis/<type>
location name will be jumpscale.clients.redis.<type></p>
<p>it can have a parent of any name</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class Location:
    &#34;&#34;&#34;dot-separated auto-location for any type

    for example, if we have a class in jumpscale/clients/redis/&lt;type&gt;
    location name will be jumpscale.clients.redis.&lt;type&gt;

    it can have a parent of any name
    &#34;&#34;&#34;

    def __init__(self, type_, parent_name):
        self.type = type_

        self.path_list = [self.type.__module__, self.type.__name__]
        if parent_name:
            self.path_list = [parent_name] + self.path_list

    @property
    def name(self):
        return &#34;.&#34;.join(self.path_list)

    @property
    def path(self):
        return os.path.join(*self.name.split(&#34;.&#34;))</code></pre>
</details>
<h3>Instance variables</h3>
<dl>
<dt id="jumpscale.core.base.store.Location.name"><code class="name">var <span class="ident">name</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">@property
def name(self):
    return &#34;.&#34;.join(self.path_list)</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.Location.path"><code class="name">var <span class="ident">path</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">@property
def path(self):
    return os.path.join(*self.name.split(&#34;.&#34;))</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="jumpscale.core.base.store.RedisStore"><code class="flex name class">
<span>class <span class="ident">RedisStore</span></span>
<span>(</span><span>type_, parent_name=None)</span>
</code></dt>
<dd>
<section class="desc"><p>secure config storage base</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">class RedisStore(EncryptedConfigStore):
    def __init__(self, type_, parent_name=None):
        super().__init__(type_, parent_name)
        redis_config = self.config_env.get_store_config(&#34;redis&#34;)
        self.redis_client = redis.Redis(redis_config[&#34;hostname&#34;], redis_config[&#34;port&#34;])

    def get_key(self, instance_name):
        return &#34;.&#34;.join([self.location.name, instance_name])

    def read(self, instance_name):
        return self.redis_client.get(self.get_key(instance_name))

    def get_type_keys(self):
        return self.redis_client.keys(f&#34;{self.location.name}.*&#34;)

    def get_instance_keys(self, instance_name):
        return self.redis_client.keys(f&#34;{self.location.name}.{instance_name}*&#34;)

    def list_all(self):
        names = []

        keys = self.get_type_keys()
        for key in keys:
            name = key.decode().replace(self.location.name, &#34;&#34;).lstrip(&#34;.&#34;)
            if &#34;.&#34; not in name:
                names.append(name)
        return names

    def write(self, instance_name, data):
        return self.redis_client.set(self.get_key(instance_name), data)

    def delete(self, instance_name):
        return self.redis_client.delete(*self.get_instance_keys(instance_name))</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="jumpscale.core.base.store.EncryptedConfigStore" href="#jumpscale.core.base.store.EncryptedConfigStore">EncryptedConfigStore</a></li>
<li><a title="jumpscale.core.base.store.ConfigStore" href="#jumpscale.core.base.store.ConfigStore">ConfigStore</a></li>
<li>abc.ABC</li>
<li><a title="jumpscale.core.base.store.EncryptionMixin" href="#jumpscale.core.base.store.EncryptionMixin">EncryptionMixin</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="jumpscale.core.base.store.RedisStore.delete"><code class="name flex">
<span>def <span class="ident">delete</span></span>(<span>self, instance_name)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def delete(self, instance_name):
    return self.redis_client.delete(*self.get_instance_keys(instance_name))</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.RedisStore.get_instance_keys"><code class="name flex">
<span>def <span class="ident">get_instance_keys</span></span>(<span>self, instance_name)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_instance_keys(self, instance_name):
    return self.redis_client.keys(f&#34;{self.location.name}.{instance_name}*&#34;)</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.RedisStore.get_key"><code class="name flex">
<span>def <span class="ident">get_key</span></span>(<span>self, instance_name)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_key(self, instance_name):
    return &#34;.&#34;.join([self.location.name, instance_name])</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.RedisStore.get_type_keys"><code class="name flex">
<span>def <span class="ident">get_type_keys</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def get_type_keys(self):
    return self.redis_client.keys(f&#34;{self.location.name}.*&#34;)</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.RedisStore.list_all"><code class="name flex">
<span>def <span class="ident">list_all</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def list_all(self):
    names = []

    keys = self.get_type_keys()
    for key in keys:
        name = key.decode().replace(self.location.name, &#34;&#34;).lstrip(&#34;.&#34;)
        if &#34;.&#34; not in name:
            names.append(name)
    return names</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.RedisStore.read"><code class="name flex">
<span>def <span class="ident">read</span></span>(<span>self, instance_name)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def read(self, instance_name):
    return self.redis_client.get(self.get_key(instance_name))</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.RedisStore.write"><code class="name flex">
<span>def <span class="ident">write</span></span>(<span>self, instance_name, data)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def write(self, instance_name, data):
    return self.redis_client.set(self.get_key(instance_name), data)</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="jumpscale.core.base.store.EncryptedConfigStore" href="#jumpscale.core.base.store.EncryptedConfigStore">EncryptedConfigStore</a></b></code>:
<ul class="hlist">
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.decrypt" href="#jumpscale.core.base.store.EncryptionMixin.decrypt">decrypt</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.encrypt" href="#jumpscale.core.base.store.EncryptionMixin.encrypt">encrypt</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.get" href="#jumpscale.core.base.store.EncryptedConfigStore.get">get</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.save" href="#jumpscale.core.base.store.EncryptedConfigStore.save">save</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="jumpscale.core.base" href="index.html">jumpscale.core.base</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="jumpscale.core.base.store.ConfigStore" href="#jumpscale.core.base.store.ConfigStore">ConfigStore</a></code></h4>
<ul class="">
<li><code><a title="jumpscale.core.base.store.ConfigStore.delete" href="#jumpscale.core.base.store.ConfigStore.delete">delete</a></code></li>
<li><code><a title="jumpscale.core.base.store.ConfigStore.list_all" href="#jumpscale.core.base.store.ConfigStore.list_all">list_all</a></code></li>
<li><code><a title="jumpscale.core.base.store.ConfigStore.read" href="#jumpscale.core.base.store.ConfigStore.read">read</a></code></li>
<li><code><a title="jumpscale.core.base.store.ConfigStore.write" href="#jumpscale.core.base.store.ConfigStore.write">write</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jumpscale.core.base.store.EncryptedConfigStore" href="#jumpscale.core.base.store.EncryptedConfigStore">EncryptedConfigStore</a></code></h4>
<ul class="">
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.get" href="#jumpscale.core.base.store.EncryptedConfigStore.get">get</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.get_all" href="#jumpscale.core.base.store.EncryptedConfigStore.get_all">get_all</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.get_type_location" href="#jumpscale.core.base.store.EncryptedConfigStore.get_type_location">get_type_location</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.location" href="#jumpscale.core.base.store.EncryptedConfigStore.location">location</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.save" href="#jumpscale.core.base.store.EncryptedConfigStore.save">save</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jumpscale.core.base.store.EncryptionMixin" href="#jumpscale.core.base.store.EncryptionMixin">EncryptionMixin</a></code></h4>
<ul class="">
<li><code><a title="jumpscale.core.base.store.EncryptionMixin.decrypt" href="#jumpscale.core.base.store.EncryptionMixin.decrypt">decrypt</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptionMixin.encrypt" href="#jumpscale.core.base.store.EncryptionMixin.encrypt">encrypt</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jumpscale.core.base.store.FileSystemStore" href="#jumpscale.core.base.store.FileSystemStore">FileSystemStore</a></code></h4>
<ul class="two-column">
<li><code><a title="jumpscale.core.base.store.FileSystemStore.config_root" href="#jumpscale.core.base.store.FileSystemStore.config_root">config_root</a></code></li>
<li><code><a title="jumpscale.core.base.store.FileSystemStore.delete" href="#jumpscale.core.base.store.FileSystemStore.delete">delete</a></code></li>
<li><code><a title="jumpscale.core.base.store.FileSystemStore.get_instance_root" href="#jumpscale.core.base.store.FileSystemStore.get_instance_root">get_instance_root</a></code></li>
<li><code><a title="jumpscale.core.base.store.FileSystemStore.get_path" href="#jumpscale.core.base.store.FileSystemStore.get_path">get_path</a></code></li>
<li><code><a title="jumpscale.core.base.store.FileSystemStore.list_all" href="#jumpscale.core.base.store.FileSystemStore.list_all">list_all</a></code></li>
<li><code><a title="jumpscale.core.base.store.FileSystemStore.make_path" href="#jumpscale.core.base.store.FileSystemStore.make_path">make_path</a></code></li>
<li><code><a title="jumpscale.core.base.store.FileSystemStore.read" href="#jumpscale.core.base.store.FileSystemStore.read">read</a></code></li>
<li><code><a title="jumpscale.core.base.store.FileSystemStore.write" href="#jumpscale.core.base.store.FileSystemStore.write">write</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jumpscale.core.base.store.InvalidPrivateKey" href="#jumpscale.core.base.store.InvalidPrivateKey">InvalidPrivateKey</a></code></h4>
</li>
<li>
<h4><code><a title="jumpscale.core.base.store.Location" href="#jumpscale.core.base.store.Location">Location</a></code></h4>
<ul class="">
<li><code><a title="jumpscale.core.base.store.Location.name" href="#jumpscale.core.base.store.Location.name">name</a></code></li>
<li><code><a title="jumpscale.core.base.store.Location.path" href="#jumpscale.core.base.store.Location.path">path</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jumpscale.core.base.store.RedisStore" href="#jumpscale.core.base.store.RedisStore">RedisStore</a></code></h4>
<ul class="two-column">
<li><code><a title="jumpscale.core.base.store.RedisStore.delete" href="#jumpscale.core.base.store.RedisStore.delete">delete</a></code></li>
<li><code><a title="jumpscale.core.base.store.RedisStore.get_instance_keys" href="#jumpscale.core.base.store.RedisStore.get_instance_keys">get_instance_keys</a></code></li>
<li><code><a title="jumpscale.core.base.store.RedisStore.get_key" href="#jumpscale.core.base.store.RedisStore.get_key">get_key</a></code></li>
<li><code><a title="jumpscale.core.base.store.RedisStore.get_type_keys" href="#jumpscale.core.base.store.RedisStore.get_type_keys">get_type_keys</a></code></li>
<li><code><a title="jumpscale.core.base.store.RedisStore.list_all" href="#jumpscale.core.base.store.RedisStore.list_all">list_all</a></code></li>
<li><code><a title="jumpscale.core.base.store.RedisStore.read" href="#jumpscale.core.base.store.RedisStore.read">read</a></code></li>
<li><code><a title="jumpscale.core.base.store.RedisStore.write" href="#jumpscale.core.base.store.RedisStore.write">write</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.6.3</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>