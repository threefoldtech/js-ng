<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>jumpscale.core.base.store API documentation</title>
<meta name="description" content="Store defines the interface for the backend storage, let it be filesystem or redis â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>jumpscale.core.base.store</code></h1>
</header>
<section id="section-intro">
<p>Store defines the interface for the backend storage, let it be filesystem or redis.</p>
<p>This module also defines the abstractions needed for any storage backend.</p>
<p>Every backend should be able to organize configuration for multiple instance given a location, also
read/write the config data in raw (string) format.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
Store defines the interface for the backend storage, let it be filesystem or redis.

This module also defines the abstractions needed for any storage backend.

Every backend should be able to organize configuration for multiple instance given a location, also
read/write the config data in raw (string) format.
&#34;&#34;&#34;


import os

from abc import ABC, abstractmethod
from enum import Enum

from jumpscale.data.nacl import NACL
from jumpscale.data.serializers import base64
from jumpscale.core.config import Environment


# we will use this as a key field name to get it when searching
KEY_FIELD_NAME = &#34;instance_name_&#34;


class InvalidPrivateKey(Exception):
    &#34;&#34;&#34;
    raised when the private key configured is invalid
    &#34;&#34;&#34;


class StoreException(Exception):
    &#34;&#34;&#34;
    raised by store backends
    &#34;&#34;&#34;


class ConfigNotFound(Exception):
    &#34;&#34;&#34;
    raised when a config is not found for an instance
    &#34;&#34;&#34;


class Location:
    &#34;&#34;&#34;
    dot-separated auto-location for any type

    for example, if we have a class in jumpscale/clients/redis/&lt;type&gt;
    location name will be jumpscale.clients.redis.&lt;type&gt;
    &#34;&#34;&#34;

    def __init__(self, *name_list, type_=None):
        self.type = type_
        self.name_list = [name for name in name_list if name]

    @property
    def name(self):
        &#34;&#34;&#34;
        get dot seprated string from current name list

        Returns:
            str: dot separated string
        &#34;&#34;&#34;
        return &#34;.&#34;.join(self.name_list)

    @property
    def path(self):
        &#34;&#34;&#34;
        get a filesystem path with from `name`, where dots are replaced by `os.sep`

        Returns:
            str: path
        &#34;&#34;&#34;
        return os.path.join(*self.name.split(&#34;.&#34;))

    @classmethod
    def from_type(cls, type_):
        &#34;&#34;&#34;
        get a location from any type/class

        Args:
            type_ (type): any type (class)

        Returns:
            Location: a location object
        &#34;&#34;&#34;
        return cls(type_.__module__, type_.__name__)

    def __str__(self):
        args = &#34;&#39;, &#39;&#34;.join(self.name_list)
        cls_name = self.__class__.__name__
        return f&#34;{cls_name}(&#39;{args}&#39;)&#34;

    __repr__ = __str__

    def __eq__(self, other):
        return self.name == other.name

    def __hash__(self):
        return hash(self.name)


class EncryptionMode(Enum):
    &#34;&#34;&#34;
    An enum to select encryption mode based on loading or storing the data
    &#34;&#34;&#34;

    Encrypt = 0
    Decrypt = 1


class EncryptionMixin:
    &#34;&#34;&#34;
    A mixin that provides encrypt and decrypt methods, which can be used in any store
    &#34;&#34;&#34;

    def encrypt(self, data):
        &#34;&#34;&#34;encrypt data

        Args:
            data (str): input string

        Returns:
            bytes: encrypted data as byte string
        &#34;&#34;&#34;
        if not isinstance(data, bytes):
            data = data.encode()
        return self.nacl.encrypt(data, self.public_key)

    def decrypt(self, data):
        &#34;&#34;&#34;decrypt data

        Args:
            data (bytes): encrypted byte string

        Returns:
            str: decrypted data
        &#34;&#34;&#34;
        return self.nacl.decrypt(data, self.public_key).decode()


class ConfigStore(ABC):
    &#34;&#34;&#34;
    the interface every config store should implement:

    - `read(instance_name)`:  reads the data of this instance name
    - `write(instance_name, data)`: writes the data of this instance
    - `list_all(instance_name)`: lists all instance names
    - `delete(instance_name)`: delete instance data
    - `find(self, cursor_=None, limit_=None, **query)`: optional search method with query as field mapping
    &#34;&#34;&#34;

    @abstractmethod
    def read(self, instance_name):
        pass

    @abstractmethod
    def write(self, instance_name, data):
        pass

    @abstractmethod
    def list_all(self):
        pass

    @abstractmethod
    def find(self, cursor_=None, limit_=None, **query):
        pass

    @abstractmethod
    def delete(self, instance_name):
        pass


class EncryptedConfigStore(ConfigStore, EncryptionMixin):
    &#34;&#34;&#34;the base class for any config store backend&#34;&#34;&#34;

    def __init__(self, location, serializer):
        &#34;&#34;&#34;
        the base for encrypted config store

        Args:
            location (Location)
            serializer (Serializer)

        Raises:
            InvalidPrivateKey: in case the private key is not configured
        &#34;&#34;&#34;
        self.location = location
        self.serializer = serializer
        self.config_env = Environment()
        self.priv_key = base64.decode(self.config_env.get_private_key())
        self.nacl = NACL(private_key=self.priv_key)
        self.public_key = self.nacl.public_key.encode()

        if not self.priv_key:
            raise InvalidPrivateKey

    def _encrypt_value(self, value):
        &#34;&#34;&#34;
        encrypt a single value

        Args:
            value (str): value

        Returns:
            str: decrypted value
        &#34;&#34;&#34;
        return base64.encode(self.encrypt(value)).decode(&#34;ascii&#34;)

    def _decrypt_value(self, value):
        &#34;&#34;&#34;
        decrypt a single value

        Args:
            value (str): value

        Returns:
            str: decrypted value
        &#34;&#34;&#34;
        return self.decrypt(base64.decode(value))

    def _process_config(self, config, mode):
        &#34;&#34;&#34;
        process current config according to encryption mode

        Args:
            config (dict): config dict (can be nested)
            mode (EncryptionMode)
        &#34;&#34;&#34;
        new_config = {}
        for name, value in config.items():
            if name.startswith(&#34;__&#34;) and value is not None:
                if mode == EncryptionMode.Decrypt:
                    new_config[name.lstrip(&#34;__&#34;)] = self._decrypt_value(value)
                else:
                    # preserve __ to know it&#39;s an encrypted value
                    new_config[name] = self._encrypt_value(value)
            elif isinstance(value, dict):
                new_config[name] = self._process_config(value, mode)
            else:
                new_config[name] = value
        return new_config

    def get(self, instance_name):
        &#34;&#34;&#34;
        get instance config

        Args:
            instance_name (str): instance name

        Returns:
            dict: instance config as dict
        &#34;&#34;&#34;
        config = self.serializer.deserialize(self.read(instance_name))
        return self._process_config(config, EncryptionMode.Decrypt)

    def find(self, cursor_=None, limit_=None, **query):
        &#34;&#34;&#34;
        a generic find, which do a linear search over all items

        if you want a better way, use a store which provides search

        Args:
            cursor_ (any, optional): an optional cursor, to start searching from. Defaults to None.
            limit_ (int, optional): results limit. Defaults to None.
            query: a mapping between field and value fo search by

        Returns:
            tuple: the new cursor, total result count and a generator for results
        &#34;&#34;&#34;
        all_names = self.list_all()
        if not all_names:
            # empty result
            return cursor_, 0, (name for name in all_names)

        all_count = len(all_names)
        if not limit_:
            limit_ = all_count

        start_search = not bool(cursor_)
        found = []

        for index in range(all_count):
            instance_name = all_names[index]
            if instance_name == cursor_:
                start_search = True

            if not start_search:
                continue

            data = self.get(instance_name)
            for name, value in query.items():
                if name in data:
                    data[KEY_FIELD_NAME] = instance_name
                    target_value = data[name]
                    if isinstance(target_value, str):
                        # just a simple normalization
                        value = str(value).lower()
                        target_value = target_value.lower()

                    if value == target_value and data not in found:
                        found.append(data)

            if len(found) &gt;= limit_:
                break

        if index == all_count - 1:
            new_cursor = None
        else:
            new_cursor = all_names[index + 1]

        # return the new cursor, total found and a generator
        return new_cursor, len(found), (config for config in found)

    def save(self, instance_name, config):
        &#34;&#34;&#34;
        save instance config

        Args:
            instance_name (str): name
            config (dict): config data, any key that starts with `__` will be encrypted

        Returns:
            bool: written or not
        &#34;&#34;&#34;
        new_config = self._process_config(config, EncryptionMode.Encrypt)
        return self.write(instance_name, self.serializer.serialize(new_config))</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="jumpscale.core.base.store.filesystem" href="filesystem.html">jumpscale.core.base.store.filesystem</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="jumpscale.core.base.store.redis" href="redis.html">jumpscale.core.base.store.redis</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="jumpscale.core.base.store.serializers" href="serializers.html">jumpscale.core.base.store.serializers</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="jumpscale.core.base.store.whooshfts" href="whooshfts.html">jumpscale.core.base.store.whooshfts</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="jumpscale.core.base.store.ConfigNotFound"><code class="flex name class">
<span>class <span class="ident">ConfigNotFound</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>raised when a config is not found for an instance</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ConfigNotFound(Exception):
    &#34;&#34;&#34;
    raised when a config is not found for an instance
    &#34;&#34;&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="jumpscale.core.base.store.ConfigStore"><code class="flex name class">
<span>class <span class="ident">ConfigStore</span></span>
</code></dt>
<dd>
<div class="desc"><p>the interface every config store should implement:</p>
<ul>
<li><code>read(instance_name)</code>:
reads the data of this instance name</li>
<li><code>write(instance_name, data)</code>: writes the data of this instance</li>
<li><code>list_all(instance_name)</code>: lists all instance names</li>
<li><code>delete(instance_name)</code>: delete instance data</li>
<li><code>find(self, cursor_=None, limit_=None, **query)</code>: optional search method with query as field mapping</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ConfigStore(ABC):
    &#34;&#34;&#34;
    the interface every config store should implement:

    - `read(instance_name)`:  reads the data of this instance name
    - `write(instance_name, data)`: writes the data of this instance
    - `list_all(instance_name)`: lists all instance names
    - `delete(instance_name)`: delete instance data
    - `find(self, cursor_=None, limit_=None, **query)`: optional search method with query as field mapping
    &#34;&#34;&#34;

    @abstractmethod
    def read(self, instance_name):
        pass

    @abstractmethod
    def write(self, instance_name, data):
        pass

    @abstractmethod
    def list_all(self):
        pass

    @abstractmethod
    def find(self, cursor_=None, limit_=None, **query):
        pass

    @abstractmethod
    def delete(self, instance_name):
        pass</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>abc.ABC</li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="jumpscale.core.base.store.EncryptedConfigStore" href="#jumpscale.core.base.store.EncryptedConfigStore">EncryptedConfigStore</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="jumpscale.core.base.store.ConfigStore.delete"><code class="name flex">
<span>def <span class="ident">delete</span></span>(<span>self, instance_name)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@abstractmethod
def delete(self, instance_name):
    pass</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.ConfigStore.find"><code class="name flex">
<span>def <span class="ident">find</span></span>(<span>self, cursor_=None, limit_=None, **query)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@abstractmethod
def find(self, cursor_=None, limit_=None, **query):
    pass</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.ConfigStore.list_all"><code class="name flex">
<span>def <span class="ident">list_all</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@abstractmethod
def list_all(self):
    pass</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.ConfigStore.read"><code class="name flex">
<span>def <span class="ident">read</span></span>(<span>self, instance_name)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@abstractmethod
def read(self, instance_name):
    pass</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.ConfigStore.write"><code class="name flex">
<span>def <span class="ident">write</span></span>(<span>self, instance_name, data)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@abstractmethod
def write(self, instance_name, data):
    pass</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="jumpscale.core.base.store.EncryptedConfigStore"><code class="flex name class">
<span>class <span class="ident">EncryptedConfigStore</span></span>
<span>(</span><span>location, serializer)</span>
</code></dt>
<dd>
<div class="desc"><p>the base class for any config store backend</p>
<p>the base for encrypted config store</p>
<h2 id="args">Args</h2>
<p>location (Location)
serializer (Serializer)</p>
<h2 id="raises">Raises</h2>
<dl>
<dt><code><a title="jumpscale.core.base.store.InvalidPrivateKey" href="#jumpscale.core.base.store.InvalidPrivateKey">InvalidPrivateKey</a></code></dt>
<dd>in case the private key is not configured</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class EncryptedConfigStore(ConfigStore, EncryptionMixin):
    &#34;&#34;&#34;the base class for any config store backend&#34;&#34;&#34;

    def __init__(self, location, serializer):
        &#34;&#34;&#34;
        the base for encrypted config store

        Args:
            location (Location)
            serializer (Serializer)

        Raises:
            InvalidPrivateKey: in case the private key is not configured
        &#34;&#34;&#34;
        self.location = location
        self.serializer = serializer
        self.config_env = Environment()
        self.priv_key = base64.decode(self.config_env.get_private_key())
        self.nacl = NACL(private_key=self.priv_key)
        self.public_key = self.nacl.public_key.encode()

        if not self.priv_key:
            raise InvalidPrivateKey

    def _encrypt_value(self, value):
        &#34;&#34;&#34;
        encrypt a single value

        Args:
            value (str): value

        Returns:
            str: decrypted value
        &#34;&#34;&#34;
        return base64.encode(self.encrypt(value)).decode(&#34;ascii&#34;)

    def _decrypt_value(self, value):
        &#34;&#34;&#34;
        decrypt a single value

        Args:
            value (str): value

        Returns:
            str: decrypted value
        &#34;&#34;&#34;
        return self.decrypt(base64.decode(value))

    def _process_config(self, config, mode):
        &#34;&#34;&#34;
        process current config according to encryption mode

        Args:
            config (dict): config dict (can be nested)
            mode (EncryptionMode)
        &#34;&#34;&#34;
        new_config = {}
        for name, value in config.items():
            if name.startswith(&#34;__&#34;) and value is not None:
                if mode == EncryptionMode.Decrypt:
                    new_config[name.lstrip(&#34;__&#34;)] = self._decrypt_value(value)
                else:
                    # preserve __ to know it&#39;s an encrypted value
                    new_config[name] = self._encrypt_value(value)
            elif isinstance(value, dict):
                new_config[name] = self._process_config(value, mode)
            else:
                new_config[name] = value
        return new_config

    def get(self, instance_name):
        &#34;&#34;&#34;
        get instance config

        Args:
            instance_name (str): instance name

        Returns:
            dict: instance config as dict
        &#34;&#34;&#34;
        config = self.serializer.deserialize(self.read(instance_name))
        return self._process_config(config, EncryptionMode.Decrypt)

    def find(self, cursor_=None, limit_=None, **query):
        &#34;&#34;&#34;
        a generic find, which do a linear search over all items

        if you want a better way, use a store which provides search

        Args:
            cursor_ (any, optional): an optional cursor, to start searching from. Defaults to None.
            limit_ (int, optional): results limit. Defaults to None.
            query: a mapping between field and value fo search by

        Returns:
            tuple: the new cursor, total result count and a generator for results
        &#34;&#34;&#34;
        all_names = self.list_all()
        if not all_names:
            # empty result
            return cursor_, 0, (name for name in all_names)

        all_count = len(all_names)
        if not limit_:
            limit_ = all_count

        start_search = not bool(cursor_)
        found = []

        for index in range(all_count):
            instance_name = all_names[index]
            if instance_name == cursor_:
                start_search = True

            if not start_search:
                continue

            data = self.get(instance_name)
            for name, value in query.items():
                if name in data:
                    data[KEY_FIELD_NAME] = instance_name
                    target_value = data[name]
                    if isinstance(target_value, str):
                        # just a simple normalization
                        value = str(value).lower()
                        target_value = target_value.lower()

                    if value == target_value and data not in found:
                        found.append(data)

            if len(found) &gt;= limit_:
                break

        if index == all_count - 1:
            new_cursor = None
        else:
            new_cursor = all_names[index + 1]

        # return the new cursor, total found and a generator
        return new_cursor, len(found), (config for config in found)

    def save(self, instance_name, config):
        &#34;&#34;&#34;
        save instance config

        Args:
            instance_name (str): name
            config (dict): config data, any key that starts with `__` will be encrypted

        Returns:
            bool: written or not
        &#34;&#34;&#34;
        new_config = self._process_config(config, EncryptionMode.Encrypt)
        return self.write(instance_name, self.serializer.serialize(new_config))</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="jumpscale.core.base.store.ConfigStore" href="#jumpscale.core.base.store.ConfigStore">ConfigStore</a></li>
<li>abc.ABC</li>
<li><a title="jumpscale.core.base.store.EncryptionMixin" href="#jumpscale.core.base.store.EncryptionMixin">EncryptionMixin</a></li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="jumpscale.core.base.store.filesystem.FileSystemStore" href="filesystem.html#jumpscale.core.base.store.filesystem.FileSystemStore">FileSystemStore</a></li>
<li><a title="jumpscale.core.base.store.redis.RedisStore" href="redis.html#jumpscale.core.base.store.redis.RedisStore">RedisStore</a></li>
<li><a title="jumpscale.core.base.store.whooshfts.WhooshStore" href="whooshfts.html#jumpscale.core.base.store.whooshfts.WhooshStore">WhooshStore</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="jumpscale.core.base.store.EncryptedConfigStore.find"><code class="name flex">
<span>def <span class="ident">find</span></span>(<span>self, cursor_=None, limit_=None, **query)</span>
</code></dt>
<dd>
<div class="desc"><p>a generic find, which do a linear search over all items</p>
<p>if you want a better way, use a store which provides search</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>cursor_</code></strong> :&ensp;<code>any</code>, optional</dt>
<dd>an optional cursor, to start searching from. Defaults to None.</dd>
<dt><strong><code>limit_</code></strong> :&ensp;<code>int</code>, optional</dt>
<dd>results limit. Defaults to None.</dd>
<dt><strong><code>query</code></strong></dt>
<dd>a mapping between field and value fo search by</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>tuple</code></dt>
<dd>the new cursor, total result count and a generator for results</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def find(self, cursor_=None, limit_=None, **query):
    &#34;&#34;&#34;
    a generic find, which do a linear search over all items

    if you want a better way, use a store which provides search

    Args:
        cursor_ (any, optional): an optional cursor, to start searching from. Defaults to None.
        limit_ (int, optional): results limit. Defaults to None.
        query: a mapping between field and value fo search by

    Returns:
        tuple: the new cursor, total result count and a generator for results
    &#34;&#34;&#34;
    all_names = self.list_all()
    if not all_names:
        # empty result
        return cursor_, 0, (name for name in all_names)

    all_count = len(all_names)
    if not limit_:
        limit_ = all_count

    start_search = not bool(cursor_)
    found = []

    for index in range(all_count):
        instance_name = all_names[index]
        if instance_name == cursor_:
            start_search = True

        if not start_search:
            continue

        data = self.get(instance_name)
        for name, value in query.items():
            if name in data:
                data[KEY_FIELD_NAME] = instance_name
                target_value = data[name]
                if isinstance(target_value, str):
                    # just a simple normalization
                    value = str(value).lower()
                    target_value = target_value.lower()

                if value == target_value and data not in found:
                    found.append(data)

        if len(found) &gt;= limit_:
            break

    if index == all_count - 1:
        new_cursor = None
    else:
        new_cursor = all_names[index + 1]

    # return the new cursor, total found and a generator
    return new_cursor, len(found), (config for config in found)</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.EncryptedConfigStore.get"><code class="name flex">
<span>def <span class="ident">get</span></span>(<span>self, instance_name)</span>
</code></dt>
<dd>
<div class="desc"><p>get instance config</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>instance_name</code></strong> :&ensp;<code>str</code></dt>
<dd>instance name</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>dict</code></dt>
<dd>instance config as dict</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get(self, instance_name):
    &#34;&#34;&#34;
    get instance config

    Args:
        instance_name (str): instance name

    Returns:
        dict: instance config as dict
    &#34;&#34;&#34;
    config = self.serializer.deserialize(self.read(instance_name))
    return self._process_config(config, EncryptionMode.Decrypt)</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.EncryptedConfigStore.save"><code class="name flex">
<span>def <span class="ident">save</span></span>(<span>self, instance_name, config)</span>
</code></dt>
<dd>
<div class="desc"><p>save instance config</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>instance_name</code></strong> :&ensp;<code>str</code></dt>
<dd>name</dd>
<dt><strong><code>config</code></strong> :&ensp;<code>dict</code></dt>
<dd>config data, any key that starts with <code>__</code> will be encrypted</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>bool</code></dt>
<dd>written or not</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save(self, instance_name, config):
    &#34;&#34;&#34;
    save instance config

    Args:
        instance_name (str): name
        config (dict): config data, any key that starts with `__` will be encrypted

    Returns:
        bool: written or not
    &#34;&#34;&#34;
    new_config = self._process_config(config, EncryptionMode.Encrypt)
    return self.write(instance_name, self.serializer.serialize(new_config))</code></pre>
</details>
</dd>
</dl>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="jumpscale.core.base.store.EncryptionMixin" href="#jumpscale.core.base.store.EncryptionMixin">EncryptionMixin</a></b></code>:
<ul class="hlist">
<li><code><a title="jumpscale.core.base.store.EncryptionMixin.decrypt" href="#jumpscale.core.base.store.EncryptionMixin.decrypt">decrypt</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptionMixin.encrypt" href="#jumpscale.core.base.store.EncryptionMixin.encrypt">encrypt</a></code></li>
</ul>
</li>
</ul>
</dd>
<dt id="jumpscale.core.base.store.EncryptionMixin"><code class="flex name class">
<span>class <span class="ident">EncryptionMixin</span></span>
</code></dt>
<dd>
<div class="desc"><p>A mixin that provides encrypt and decrypt methods, which can be used in any store</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class EncryptionMixin:
    &#34;&#34;&#34;
    A mixin that provides encrypt and decrypt methods, which can be used in any store
    &#34;&#34;&#34;

    def encrypt(self, data):
        &#34;&#34;&#34;encrypt data

        Args:
            data (str): input string

        Returns:
            bytes: encrypted data as byte string
        &#34;&#34;&#34;
        if not isinstance(data, bytes):
            data = data.encode()
        return self.nacl.encrypt(data, self.public_key)

    def decrypt(self, data):
        &#34;&#34;&#34;decrypt data

        Args:
            data (bytes): encrypted byte string

        Returns:
            str: decrypted data
        &#34;&#34;&#34;
        return self.nacl.decrypt(data, self.public_key).decode()</code></pre>
</details>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="jumpscale.core.base.store.EncryptedConfigStore" href="#jumpscale.core.base.store.EncryptedConfigStore">EncryptedConfigStore</a></li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="jumpscale.core.base.store.EncryptionMixin.decrypt"><code class="name flex">
<span>def <span class="ident">decrypt</span></span>(<span>self, data)</span>
</code></dt>
<dd>
<div class="desc"><p>decrypt data</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>data</code></strong> :&ensp;<code>bytes</code></dt>
<dd>encrypted byte string</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>decrypted data</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def decrypt(self, data):
    &#34;&#34;&#34;decrypt data

    Args:
        data (bytes): encrypted byte string

    Returns:
        str: decrypted data
    &#34;&#34;&#34;
    return self.nacl.decrypt(data, self.public_key).decode()</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.EncryptionMixin.encrypt"><code class="name flex">
<span>def <span class="ident">encrypt</span></span>(<span>self, data)</span>
</code></dt>
<dd>
<div class="desc"><p>encrypt data</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>data</code></strong> :&ensp;<code>str</code></dt>
<dd>input string</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>bytes</code></dt>
<dd>encrypted data as byte string</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def encrypt(self, data):
    &#34;&#34;&#34;encrypt data

    Args:
        data (str): input string

    Returns:
        bytes: encrypted data as byte string
    &#34;&#34;&#34;
    if not isinstance(data, bytes):
        data = data.encode()
    return self.nacl.encrypt(data, self.public_key)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="jumpscale.core.base.store.EncryptionMode"><code class="flex name class">
<span>class <span class="ident">EncryptionMode</span></span>
<span>(</span><span>value, names=None, *, module=None, qualname=None, type=None, start=1)</span>
</code></dt>
<dd>
<div class="desc"><p>An enum to select encryption mode based on loading or storing the data</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class EncryptionMode(Enum):
    &#34;&#34;&#34;
    An enum to select encryption mode based on loading or storing the data
    &#34;&#34;&#34;

    Encrypt = 0
    Decrypt = 1</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="jumpscale.core.base.store.EncryptionMode.Decrypt"><code class="name">var <span class="ident">Decrypt</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="jumpscale.core.base.store.EncryptionMode.Encrypt"><code class="name">var <span class="ident">Encrypt</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
<dt id="jumpscale.core.base.store.InvalidPrivateKey"><code class="flex name class">
<span>class <span class="ident">InvalidPrivateKey</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>raised when the private key configured is invalid</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class InvalidPrivateKey(Exception):
    &#34;&#34;&#34;
    raised when the private key configured is invalid
    &#34;&#34;&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="jumpscale.core.base.store.Location"><code class="flex name class">
<span>class <span class="ident">Location</span></span>
<span>(</span><span>*name_list, type_=None)</span>
</code></dt>
<dd>
<div class="desc"><p>dot-separated auto-location for any type</p>
<p>for example, if we have a class in jumpscale/clients/redis/<type>
location name will be jumpscale.clients.redis.<type></p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Location:
    &#34;&#34;&#34;
    dot-separated auto-location for any type

    for example, if we have a class in jumpscale/clients/redis/&lt;type&gt;
    location name will be jumpscale.clients.redis.&lt;type&gt;
    &#34;&#34;&#34;

    def __init__(self, *name_list, type_=None):
        self.type = type_
        self.name_list = [name for name in name_list if name]

    @property
    def name(self):
        &#34;&#34;&#34;
        get dot seprated string from current name list

        Returns:
            str: dot separated string
        &#34;&#34;&#34;
        return &#34;.&#34;.join(self.name_list)

    @property
    def path(self):
        &#34;&#34;&#34;
        get a filesystem path with from `name`, where dots are replaced by `os.sep`

        Returns:
            str: path
        &#34;&#34;&#34;
        return os.path.join(*self.name.split(&#34;.&#34;))

    @classmethod
    def from_type(cls, type_):
        &#34;&#34;&#34;
        get a location from any type/class

        Args:
            type_ (type): any type (class)

        Returns:
            Location: a location object
        &#34;&#34;&#34;
        return cls(type_.__module__, type_.__name__)

    def __str__(self):
        args = &#34;&#39;, &#39;&#34;.join(self.name_list)
        cls_name = self.__class__.__name__
        return f&#34;{cls_name}(&#39;{args}&#39;)&#34;

    __repr__ = __str__

    def __eq__(self, other):
        return self.name == other.name

    def __hash__(self):
        return hash(self.name)</code></pre>
</details>
<h3>Static methods</h3>
<dl>
<dt id="jumpscale.core.base.store.Location.from_type"><code class="name flex">
<span>def <span class="ident">from_type</span></span>(<span>type_)</span>
</code></dt>
<dd>
<div class="desc"><p>get a location from any type/class</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>type_</code></strong> :&ensp;<code>type</code></dt>
<dd>any type (class)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code><a title="jumpscale.core.base.store.Location" href="#jumpscale.core.base.store.Location">Location</a></code></dt>
<dd>a location object</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@classmethod
def from_type(cls, type_):
    &#34;&#34;&#34;
    get a location from any type/class

    Args:
        type_ (type): any type (class)

    Returns:
        Location: a location object
    &#34;&#34;&#34;
    return cls(type_.__module__, type_.__name__)</code></pre>
</details>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="jumpscale.core.base.store.Location.name"><code class="name">var <span class="ident">name</span></code></dt>
<dd>
<div class="desc"><p>get dot seprated string from current name list</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>dot separated string</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def name(self):
    &#34;&#34;&#34;
    get dot seprated string from current name list

    Returns:
        str: dot separated string
    &#34;&#34;&#34;
    return &#34;.&#34;.join(self.name_list)</code></pre>
</details>
</dd>
<dt id="jumpscale.core.base.store.Location.path"><code class="name">var <span class="ident">path</span></code></dt>
<dd>
<div class="desc"><p>get a filesystem path with from <code>name</code>, where dots are replaced by <code>os.sep</code></p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>path</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def path(self):
    &#34;&#34;&#34;
    get a filesystem path with from `name`, where dots are replaced by `os.sep`

    Returns:
        str: path
    &#34;&#34;&#34;
    return os.path.join(*self.name.split(&#34;.&#34;))</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="jumpscale.core.base.store.StoreException"><code class="flex name class">
<span>class <span class="ident">StoreException</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>raised by store backends</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class StoreException(Exception):
    &#34;&#34;&#34;
    raised by store backends
    &#34;&#34;&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="jumpscale.core.base" href="../index.html">jumpscale.core.base</a></code></li>
</ul>
</li>
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="jumpscale.core.base.store.filesystem" href="filesystem.html">jumpscale.core.base.store.filesystem</a></code></li>
<li><code><a title="jumpscale.core.base.store.redis" href="redis.html">jumpscale.core.base.store.redis</a></code></li>
<li><code><a title="jumpscale.core.base.store.serializers" href="serializers.html">jumpscale.core.base.store.serializers</a></code></li>
<li><code><a title="jumpscale.core.base.store.whooshfts" href="whooshfts.html">jumpscale.core.base.store.whooshfts</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="jumpscale.core.base.store.ConfigNotFound" href="#jumpscale.core.base.store.ConfigNotFound">ConfigNotFound</a></code></h4>
</li>
<li>
<h4><code><a title="jumpscale.core.base.store.ConfigStore" href="#jumpscale.core.base.store.ConfigStore">ConfigStore</a></code></h4>
<ul class="">
<li><code><a title="jumpscale.core.base.store.ConfigStore.delete" href="#jumpscale.core.base.store.ConfigStore.delete">delete</a></code></li>
<li><code><a title="jumpscale.core.base.store.ConfigStore.find" href="#jumpscale.core.base.store.ConfigStore.find">find</a></code></li>
<li><code><a title="jumpscale.core.base.store.ConfigStore.list_all" href="#jumpscale.core.base.store.ConfigStore.list_all">list_all</a></code></li>
<li><code><a title="jumpscale.core.base.store.ConfigStore.read" href="#jumpscale.core.base.store.ConfigStore.read">read</a></code></li>
<li><code><a title="jumpscale.core.base.store.ConfigStore.write" href="#jumpscale.core.base.store.ConfigStore.write">write</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jumpscale.core.base.store.EncryptedConfigStore" href="#jumpscale.core.base.store.EncryptedConfigStore">EncryptedConfigStore</a></code></h4>
<ul class="">
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.find" href="#jumpscale.core.base.store.EncryptedConfigStore.find">find</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.get" href="#jumpscale.core.base.store.EncryptedConfigStore.get">get</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptedConfigStore.save" href="#jumpscale.core.base.store.EncryptedConfigStore.save">save</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jumpscale.core.base.store.EncryptionMixin" href="#jumpscale.core.base.store.EncryptionMixin">EncryptionMixin</a></code></h4>
<ul class="">
<li><code><a title="jumpscale.core.base.store.EncryptionMixin.decrypt" href="#jumpscale.core.base.store.EncryptionMixin.decrypt">decrypt</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptionMixin.encrypt" href="#jumpscale.core.base.store.EncryptionMixin.encrypt">encrypt</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jumpscale.core.base.store.EncryptionMode" href="#jumpscale.core.base.store.EncryptionMode">EncryptionMode</a></code></h4>
<ul class="">
<li><code><a title="jumpscale.core.base.store.EncryptionMode.Decrypt" href="#jumpscale.core.base.store.EncryptionMode.Decrypt">Decrypt</a></code></li>
<li><code><a title="jumpscale.core.base.store.EncryptionMode.Encrypt" href="#jumpscale.core.base.store.EncryptionMode.Encrypt">Encrypt</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jumpscale.core.base.store.InvalidPrivateKey" href="#jumpscale.core.base.store.InvalidPrivateKey">InvalidPrivateKey</a></code></h4>
</li>
<li>
<h4><code><a title="jumpscale.core.base.store.Location" href="#jumpscale.core.base.store.Location">Location</a></code></h4>
<ul class="">
<li><code><a title="jumpscale.core.base.store.Location.from_type" href="#jumpscale.core.base.store.Location.from_type">from_type</a></code></li>
<li><code><a title="jumpscale.core.base.store.Location.name" href="#jumpscale.core.base.store.Location.name">name</a></code></li>
<li><code><a title="jumpscale.core.base.store.Location.path" href="#jumpscale.core.base.store.Location.path">path</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="jumpscale.core.base.store.StoreException" href="#jumpscale.core.base.store.StoreException">StoreException</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>